<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ecenter San Luis - Occupational Permit</title>
    <link rel="stylesheet" href="AdminOccuForm.css">
    <link rel="icon" href="Pic/favicon.png">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" />
    <link rel="stylesheet" href="https://unpkg.com/boxicons/css/boxicons.min.css">
    <script src="https://code.iconify.design/2/2.1.0/iconify.min.js"></script>
</head>

<body>
    <div class="sidebar">
        <img src="Pic/favicon.png" alt="Logo">
        <h2>Menu</h2>
        <ul>
            <li><a href="Dashboard.html"><i class="bx bxs-dashboard"></i> Dashboard</a></li>
            <li><a href="VeryfingDocuments.html"><i class='bx bxs-file-find'></i> Verifying Documents</a></li>
            <li><a href="AdminOccuForm.html"><i class="fas fa-id-card icon"></i> Occupational Form</a></li>
            <li><a href="FranchiseForm.html"><i class="fas fa-id-card icon"></i> Franchise Form</a></li>
            <li><a href="payment.html"><i class='bx bxs-wallet-alt'></i> Payment</a></li>
            <a href="#" id="logoutButton" class="logout"><i class="fas fa-sign-out-alt"></i> Logout</a> 
        </ul>
    </div>
    <div class="main-content">
        <h1>OCCUPATIONAL APPLICATION FORM</h1>

        <div id="alert-container" class="alert hidden">
            <span id="alert-icon"></span>
            <span id="alert-message"></span>
        </div>

        <form onsubmit="calculateAge(); return confirmSubmission(event)" method="post" action="http://localhost:8000/submitForm" enctype="multipart/form-data">
            <div class="form-group-4">
                <div class="form-field">
                    <label for="lastName">Last Name</label>
                    <input type="text" id="lastName" name="lastName" required>
                </div>
                <div class="form-field">
                    <label for="firstName">First Name</label>
                    <input type="text" id="firstName" name="firstName" required>
                </div>
                <div class="form-field">
                    <label for="middleName">Middle Name</label>
                    <input type="text" id="middleName" name="middleName">
                </div>
                <div class="form-field">
                    <label for="suffix">Suffix</label>
                    <input type="text" id="suffix" name="suffix">
                </div>
            </div>

            <div class="form-group-4">
                <div class="form-field">
                    <label for="gender">Gender</label>
                    <select id="gender" name="gender" required>
                        <option value="male">Male</option>
                        <option value="female">Female</option>
                        <option value="other">Other</option>
                    </select>
                </div>
                <div class="form-field">
                    <label for="civilStatus">Civil Status</label>
                    <select id="civilStatus" name="civilStatus" required>
                        <option value="single">Single</option>
                        <option value="married">Married</option>
                        <option value="widowed">Widowed</option>
                    </select>
                </div>
                <div class="form-field">
                    <label for="dob">Date of Birth</label>
                    <input type="date" id="dob" name="dob" onchange="calculateAge()" required>
                </div>
                <div class="form-field">
                    <label for="age">Age</label>
                    <input type="number" id="age" name="age" disabled>
                </div>
            </div>

            <div class="form-group-4">
                <div class="form-field">
                    <label for="placeOfBirth">Place of Birth</label>
                    <input type="text" id="placeOfBirth" name="placeOfBirth" required>
                </div>
                <div class="form-field">
                    <label for="homeAddress">Home Address</label>
                    <input type="text" id="homeAddress" name="homeAddress" required>
                </div>
                <div class="form-field">
                    <label for="cellphoneNumber">Cellphone Number</label>
                    <input type="tel" id="cellphoneNumber" name="cellphoneNumber" required>
                </div>
                <div class="form-field">
                    <label for="email">E-mail Address</label>
                    <input type="email" id="email" name="email" required>
                </div>
            </div>

            <div class="form-group-4">
                <div class="form-field">
                    <label for="companyName">Company Name</label>
                    <input type="text" id="companyName" name="companyName" required>
                </div>
                <div class="form-field">
                    <label for="jobPosition">Job Position</label>
                    <input type="text" id="jobPosition" name="jobPosition" required>
                </div>
                
                <div class="form-field">
                    <label for="combinedId">ID Type and Number</label>
                    <div class="id-type-container">
                        <select id="Typeofid" name="Typeofid" required>
                            <option value="Drivers License">Drivers License</option>
                            <option value="Philhealth">Philhealth</option>
                            <option value="NBI">NBI</option>
                            <option value="Company Id">Company ID</option>
                            <option value="Philsys ID">Philsys ID</option>
                            <option value="National">National</option>
                        </select>
                        <input type="text" id="IDnumber" name="IDnumber" placeholder="ID Number" required>
                    </div>
                    <input type="hidden" id="combinedId" name="combinedId">
                </div>
            </div>


            <label for="coe">Certificate of Employment</label>
            <input type="file" id="coe" name="coe" required>

            <label for="healthCard">Health Card (If Job Requires)</label>
            <input type="file" id="healthCard" name="healthCard">

            <label for="birthCertificate">Birth Certificate Or Affidavit of Consent (if Applicant is MINOR)</label>
            <input type="file" id="birthCertificate" name="birthCertificate">

            <label for="officialReceipt">Official Receipt</label>
            <input type="file" id="officialReceipt" name="officialReceipt" required>

            <div class="form-group-4">
                <div class="form-field">
                    <label for="orNumber">OR Number</label>
                    <input type="text" id="orNumber" name="orNumber">
                </div>
                <div class="form-field">
                    <label for="orExtension">OR Extension</label>
                    <input type="text" id="orExtension" name="orExtension">
                </div>
                <div class="form-field">
                    <label for="orDate">OR Date</label>
                    <input type="date" id="orDate" name="orDate" required>
                </div>
                <div class="form-field">
                    <label for="orAmount">OR Amount</label>
                    <input type="text" id="orAmount" name="orAmount" value="â‚± ">
                </div>
            </div>

            <div class="form-group-4">
                <div class="form-field">
                    <label for="ctcNumber">CTC Number</label>
                    <input type="text" id="ctcNumber" name="ctcNumber" required>
                </div>
                <div class="form-field">
                    <label for="ctcDateIssued">CTC Date Issued</label>
                    <input type="date" id="ctcDateIssued" name="ctcDateIssued" required>
                </div>
                <div class="form-field">
                    <label for="ctcPlaceIssued">CTC Place Issued</label>
                    <input type="text" id="ctcPlaceIssued" name="ctcPlaceIssued" required>
                </div>
            </div>

            <div class="form-group">
                <div class="form-field checkbox-container">
                    <input type="checkbox" id="consent" name="consent" required>
                    <label for="consent" class="consent-text">
                        I hereby certify that all the information provided are true and correct based on personal knowledge of facts and further consent to the collection, use, and processing of my personal information by Municipal Government of San Luis for the purpose of processing my Occupational Permit application. I understand my information may be shared with relevant authorities and service providers as necessary. I acknowledge my rights regarding my personal data as outlined by data privacy laws.
                    </label>
                </div>
            </div>

            <button type="submit">Submit</button>
            <button type="button" class="clear-button" onclick="clearForm()">Clear Form</button>
        </form>
    </div>

    <script>
         function calculateAge() {
            const dob = document.getElementById('dob').value;
            const ageField = document.getElementById('age');

            if (dob) {
                const dobDate = new Date(dob);
                const today = new Date();
                let age = today.getFullYear() - dobDate.getFullYear();
                const monthDifference = today.getMonth() - dobDate.getMonth();

                if (monthDifference < 0 || (monthDifference === 0 && today.getDate() < dobDate.getDate())) {
                    age--;
                }

                ageField.value = age;
                ageField.disabled = false;  // Enable the age field
            }
        }
        
        async function confirmSubmission(event) {
    event.preventDefault(); // Prevent the form from submitting immediately

    const idType = document.getElementById('Typeofid').value;
    const idNumber = document.getElementById('IDnumber').value;
    const combinedIdField = document.getElementById('combinedId');
    
    combinedIdField.value = `${idType}: ${idNumber}`;


    const confirmed = confirm("Are you sure you want to submit this form?");

    if (confirmed) {
        try {
            const form = document.querySelector('form');
            const formData = new FormData(form);

            const response = await fetch(form.action, {
                method: form.method,
                body: formData,
            });

            if (response.ok) {
                showAlert('Form submitted successfully!', 'success');
            } else {
                const errorData = await response.json();
                showAlert(`Error: ${errorData.message}`, 'error');


            }
        } catch (error) {
            showAlert(`Submission failed: ${error.message}`, 'error');

        }
    }
}

function showAlert(message, type) {
    const alertContainer = document.getElementById('alert-container');
    const alertMessage = document.getElementById('alert-message');
    const alertIcon = document.getElementById('alert-icon');

    alertMessage.textContent = message;

    if (type === 'success') {
        alertIcon.innerHTML = '<i class="fas fa-check-circle"></i>';
        alertContainer.className = 'alert success';
    } else if (type === 'error') {
        alertIcon.innerHTML = '<i class="fas fa-exclamation-circle"></i>';
        alertContainer.className = 'alert error';
    }

    alertContainer.style.display = 'flex'; // Ensure it is visible
    
    window.scrollTo(0, 0); // Scroll to the top

    setTimeout(() => {
        alertContainer.style.display = 'none'; // Hide after 2 seconds
        // Only clear the form if the submission was successful
        if (type === 'success') {
            clearForm(); 
        }
    }, 2000); // Hide alert after 2 seconds
}


function clearForm() {
    const form = document.querySelector('form');
    form.reset();
    document.getElementById('age').value = '';
    document.getElementById('age').disabled = true;
}

document.getElementById('logoutButton').addEventListener('click', function(event) {
            event.preventDefault(); // Prevent the default link behavior
            var confirmation = confirm("Are you sure you want to log out?");
            if (confirmation) {
                window.location.href = 'login.html'; // Redirect to the login page
            }
        });

    </script>
</body>

</html>